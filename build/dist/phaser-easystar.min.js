"use strict";function createCommonjsModule(t,n){return n={exports:{}},t(n,n.exports),n.exports}var instance=function(){this.pointsToAvoid={},this.startX,this.callback,this.startY,this.endX,this.endY,this.nodeHash={},this.openList},node=function(t,n,e,r,o){this.parent=t,this.x=n,this.y=e,this.costSoFar=r,this.simpleDistanceToTarget=o,this.bestGuessDistance=function(){return this.costSoFar+this.simpleDistanceToTarget}},heap$2=createCommonjsModule(function(t,n){(function(){var n,e,r,o,i,s,a,u,l,c,h,p,f,y,d;r=Math.floor,c=Math.min,e=function(t,n){return t<n?-1:t>n?1:0},l=function(t,n,o,i,s){var a;if(null==o&&(o=0),null==s&&(s=e),o<0)throw new Error("lo must be non-negative");for(null==i&&(i=t.length);o<i;)s(n,t[a=r((o+i)/2)])<0?i=a:o=a+1;return[].splice.apply(t,[o,o-o].concat(n)),n},s=function(t,n,r){return null==r&&(r=e),t.push(n),y(t,0,t.length-1,r)},i=function(t,n){var r,o;return null==n&&(n=e),r=t.pop(),t.length?(o=t[0],t[0]=r,d(t,0,n)):o=r,o},u=function(t,n,r){var o;return null==r&&(r=e),o=t[0],t[0]=n,d(t,0,r),o},a=function(t,n,r){var o;return null==r&&(r=e),t.length&&r(t[0],n)<0&&(n=(o=[t[0],n])[0],t[0]=o[1],d(t,0,r)),n},o=function(t,n){var o,i,s,a,u,l;for(null==n&&(n=e),u=[],i=0,s=(a=function(){l=[];for(var n=0,e=r(t.length/2);0<=e?n<e:n>e;0<=e?n++:n--)l.push(n);return l}.apply(this).reverse()).length;i<s;i++)o=a[i],u.push(d(t,o,n));return u},f=function(t,n,r){var o;if(null==r&&(r=e),-1!==(o=t.indexOf(n)))return y(t,0,o,r),d(t,o,r)},h=function(t,n,r){var i,s,u,l,c;if(null==r&&(r=e),!(s=t.slice(0,n)).length)return s;for(o(s,r),u=0,l=(c=t.slice(n)).length;u<l;u++)i=c[u],a(s,i,r);return s.sort(r).reverse()},p=function(t,n,r){var s,a,u,h,p,f,y,d,v;if(null==r&&(r=e),10*n<=t.length){if(!(u=t.slice(0,n).sort(r)).length)return u;for(a=u[u.length-1],h=0,f=(y=t.slice(n)).length;h<f;h++)r(s=y[h],a)<0&&(l(u,s,0,null,r),u.pop(),a=u[u.length-1]);return u}for(o(t,r),v=[],p=0,d=c(n,t.length);0<=d?p<d:p>d;0<=d?++p:--p)v.push(i(t,r));return v},y=function(t,n,r,o){var i,s,a;for(null==o&&(o=e),i=t[r];r>n&&o(i,s=t[a=r-1>>1])<0;)t[r]=s,r=a;return t[r]=i},d=function(t,n,r){var o,i,s,a,u;for(null==r&&(r=e),i=t.length,u=n,s=t[n],o=2*n+1;o<i;)(a=o+1)<i&&!(r(t[o],t[a])<0)&&(o=a),t[n]=t[o],o=2*(n=o)+1;return t[n]=s,y(t,u,n,r)},n=function(){function t(t){this.cmp=null!=t?t:e,this.nodes=[]}return t.push=s,t.pop=i,t.replace=u,t.pushpop=a,t.heapify=o,t.updateItem=f,t.nlargest=h,t.nsmallest=p,t.prototype.push=function(t){return s(this.nodes,t,this.cmp)},t.prototype.pop=function(){return i(this.nodes,this.cmp)},t.prototype.peek=function(){return this.nodes[0]},t.prototype.contains=function(t){return-1!==this.nodes.indexOf(t)},t.prototype.replace=function(t){return u(this.nodes,t,this.cmp)},t.prototype.pushpop=function(t){return a(this.nodes,t,this.cmp)},t.prototype.heapify=function(){return o(this.nodes,this.cmp)},t.prototype.updateItem=function(t){return f(this.nodes,t,this.cmp)},t.prototype.clear=function(){return this.nodes=[]},t.prototype.empty=function(){return 0===this.nodes.length},t.prototype.size=function(){return this.nodes.length},t.prototype.clone=function(){var n;return n=new t,n.nodes=this.nodes.slice(0),n},t.prototype.toArray=function(){return this.nodes.slice(0)},t.prototype.insert=t.prototype.push,t.prototype.top=t.prototype.peek,t.prototype.front=t.prototype.peek,t.prototype.has=t.prototype.contains,t.prototype.copy=t.prototype.clone,t}(),function(n,e){t.exports=e()}(0,function(){return n})}).call(this)}),heap=heap$2,EasyStar={};const CLOSED_LIST=0,OPEN_LIST=1;var easystar$1=EasyStar,nextInstanceId=1;EasyStar.js=function(){var t,n,e,r=!1,o={},i={},s={},a={},u=!0,l={},c=[],h=Number.MAX_VALUE,p=!1;this.setAcceptableTiles=function(t){t instanceof Array?e=t:!isNaN(parseFloat(t))&&isFinite(t)&&(e=[t])},this.enableSync=function(){r=!0},this.disableSync=function(){r=!1},this.enableDiagonals=function(){p=!0},this.disableDiagonals=function(){p=!1},this.setGrid=function(n){t=n;for(var e=0;e<t.length;e++)for(var r=0;r<t[0].length;r++)i[t[e][r]]||(i[t[e][r]]=1)},this.setTileCost=function(t,n){i[t]=n},this.setAdditionalPointCost=function(t,n,e){void 0===s[n]&&(s[n]={}),s[n][t]=e},this.removeAdditionalPointCost=function(t,n){void 0!==s[n]&&delete s[n][t]},this.removeAllAdditionalPointCosts=function(){s={}},this.setDirectionalCondition=function(t,n,e){void 0===a[n]&&(a[n]={}),a[n][t]=e},this.removeAllDirectionalConditions=function(){a={}},this.setIterationsPerCalculation=function(t){h=t},this.avoidAdditionalPoint=function(t,n){void 0===o[n]&&(o[n]={}),o[n][t]=1},this.stopAvoidingAdditionalPoint=function(t,n){void 0!==o[n]&&delete o[n][t]},this.enableCornerCutting=function(){u=!0},this.disableCornerCutting=function(){u=!1},this.stopAvoidingAllAdditionalPoints=function(){o={}},this.findPath=function(n,o,i,s,a){var u=function(t){r?a(t):setTimeout(function(){a(t)})};if(void 0===e)throw new Error("You can't set a path without first calling setAcceptableTiles() on EasyStar.");if(void 0===t)throw new Error("You can't set a path without first calling setGrid() on EasyStar.");if(n<0||o<0||i<0||s<0||n>t[0].length-1||o>t.length-1||i>t[0].length-1||s>t.length-1)throw new Error("Your start or end point is outside the scope of your grid.");if(n!==i||o!==s){for(var h=t[s][i],p=!1,f=0;f<e.length;f++)if(h===e[f]){p=!0;break}if(!1!==p){var y=new instance;y.openList=new heap(function(t,n){return t.bestGuessDistance()-n.bestGuessDistance()}),y.isDoneCalculating=!1,y.nodeHash={},y.startX=n,y.startY=o,y.endX=i,y.endY=s,y.callback=u,y.openList.push(T(y,y.startX,y.startY,null,1));var d=nextInstanceId++;return l[d]=y,c.push(d),d}u(null)}else u([])},this.cancelPath=function(t){return t in l&&(delete l[t],!0)},this.calculate=function(){if(0!==c.length&&void 0!==t&&void 0!==e)for(n=0;n<h;n++){if(0===c.length)return;r&&(n=0);var o=c[0],i=l[o];if(void 0!==i)if(0!==i.openList.size()){var s=i.openList.pop();if(i.endX!==s.x||i.endY!==s.y)s.list=0,s.y>0&&f(i,s,0,-1,1*v(s.x,s.y-1)),s.x<t[0].length-1&&f(i,s,1,0,1*v(s.x+1,s.y)),s.y<t.length-1&&f(i,s,0,1,1*v(s.x,s.y+1)),s.x>0&&f(i,s,-1,0,1*v(s.x-1,s.y)),p&&(s.x>0&&s.y>0&&(u||y(t,e,s.x,s.y-1)&&y(t,e,s.x-1,s.y))&&f(i,s,-1,-1,1.4*v(s.x-1,s.y-1)),s.x<t[0].length-1&&s.y<t.length-1&&(u||y(t,e,s.x,s.y+1)&&y(t,e,s.x+1,s.y))&&f(i,s,1,1,1.4*v(s.x+1,s.y+1)),s.x<t[0].length-1&&s.y>0&&(u||y(t,e,s.x,s.y-1)&&y(t,e,s.x+1,s.y))&&f(i,s,1,-1,1.4*v(s.x+1,s.y-1)),s.x>0&&s.y<t.length-1&&(u||y(t,e,s.x,s.y+1)&&y(t,e,s.x-1,s.y))&&f(i,s,-1,1,1.4*v(s.x-1,s.y+1)));else{var a=[];a.push({x:s.x,y:s.y});for(var d=s.parent;null!=d;)a.push({x:d.x,y:d.y}),d=d.parent;a.reverse();var T=a;i.callback(T),delete l[o],c.shift()}}else i.callback(null),delete l[o],c.shift();else c.shift()}};var f=function(n,r,i,s,a){var u=r.x+i,l=r.y+s;if((void 0===o[l]||void 0===o[l][u])&&y(t,e,u,l,r)){var c=T(n,u,l,r,a);void 0===c.list?(c.list=1,n.openList.push(c)):r.costSoFar+a<c.costSoFar&&(c.costSoFar=r.costSoFar+a,c.parent=r,n.openList.updateItem(c))}},y=function(t,n,e,r,o){var i=a[r]&&a[r][e];if(i){var s=d(o.x-e,o.y-r);if(!function(){for(var t=0;t<i.length;t++)if(i[t]===s)return!0;return!1}())return!1}for(var u=0;u<n.length;u++)if(t[r][e]===n[u])return!0;return!1},d=function(t,n){if(0===t&&-1===n)return EasyStar.TOP;if(1===t&&-1===n)return EasyStar.TOP_RIGHT;if(1===t&&0===n)return EasyStar.RIGHT;if(1===t&&1===n)return EasyStar.BOTTOM_RIGHT;if(0===t&&1===n)return EasyStar.BOTTOM;if(-1===t&&1===n)return EasyStar.BOTTOM_LEFT;if(-1===t&&0===n)return EasyStar.LEFT;if(-1===t&&-1===n)return EasyStar.TOP_LEFT;throw new Error("These differences are not valid: "+t+", "+n)},v=function(n,e){return s[e]&&s[e][n]||i[t[e][n]]},T=function(t,n,e,r,o){if(void 0!==t.nodeHash[e]){if(void 0!==t.nodeHash[e][n])return t.nodeHash[e][n]}else t.nodeHash[e]={};var i=g(n,e,t.endX,t.endY);if(null!==r)var s=r.costSoFar+o;else s=0;var a=new node(r,n,e,s,i);return t.nodeHash[e][n]=a,a},g=function(t,n,e,r){if(p)return(o=Math.abs(t-e))<(i=Math.abs(n-r))?1.4*o+i:1.4*i+o;var o=Math.abs(t-e),i=Math.abs(n-r);return o+i}},EasyStar.TOP="TOP",EasyStar.TOP_RIGHT="TOP_RIGHT",EasyStar.RIGHT="RIGHT",EasyStar.BOTTOM_RIGHT="BOTTOM_RIGHT",EasyStar.BOTTOM="BOTTOM",EasyStar.BOTTOM_LEFT="BOTTOM_LEFT",EasyStar.LEFT="LEFT",EasyStar.TOP_LEFT="TOP_LEFT";var easystar_1=easystar$1.js,__extends=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),PhaserEasystar=function(t){function n(n){var e=t.call(this,n,n.plugins)||this;return e.easystar=new easystar_1,e.callback=null,e.prepared=!1,e}return __extends(n,t),n.prototype.setGrid=function(t,n,e){void 0===e&&(e=Number.MAX_VALUE),this.grid=[];for(var r=0;r<t.length;r++){this.grid[r]=[];for(var o=0;o<t[r].length;o++)this.grid[r][o]=t[r][o]?t[r][o].index:0}this.easystar.setGrid(this.grid),this.easystar.setAcceptableTiles(n);for(var i=0,s=n;i<s.length;i++){var a=s[i];this.easystar.setTileCost(a,1)}this.easystar.setIterationsPerCalculation(e)},n.prototype.setCallbackFunction=function(t){this.callback=t},n.prototype.preparePathCalculation=function(t,n){if(null===this.callback)throw new Error("no callback set");this.easystar.findPath(t[0],t[1],n[0],n[1],this.callback),this.prepared=!0},n.prototype.calculatePath=function(){if(!this.prepared)throw new Error("no calculation prepared!");this.easystar.calculate()},n}(Phaser.Plugin);module.exports=PhaserEasystar;
