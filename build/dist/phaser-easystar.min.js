var PhaserEasystar=function(){"use strict";function t(t,n){return n={exports:{}},t(n,n.exports),n.exports}var n=function(){this.pointsToAvoid={},this.startX,this.callback,this.startY,this.endX,this.endY,this.nodeHash={},this.openList},e=function(t,n,e,r,i){this.parent=t,this.x=n,this.y=e,this.costSoFar=r,this.simpleDistanceToTarget=i,this.bestGuessDistance=function(){return this.costSoFar+this.simpleDistanceToTarget}},r=t(function(t,n){(function(){var n,e,r,i,o,s,a,u,l,c,h,f,p,d,y;r=Math.floor,c=Math.min,e=function(t,n){return t<n?-1:t>n?1:0},l=function(t,n,i,o,s){var a;if(null==i&&(i=0),null==s&&(s=e),i<0)throw new Error("lo must be non-negative");for(null==o&&(o=t.length);i<o;)s(n,t[a=r((i+o)/2)])<0?o=a:i=a+1;return[].splice.apply(t,[i,i-i].concat(n)),n},s=function(t,n,r){return null==r&&(r=e),t.push(n),d(t,0,t.length-1,r)},o=function(t,n){var r,i;return null==n&&(n=e),r=t.pop(),t.length?(i=t[0],t[0]=r,y(t,0,n)):i=r,i},u=function(t,n,r){var i;return null==r&&(r=e),i=t[0],t[0]=n,y(t,0,r),i},a=function(t,n,r){var i;return null==r&&(r=e),t.length&&r(t[0],n)<0&&(n=(i=[t[0],n])[0],t[0]=i[1],y(t,0,r)),n},i=function(t,n){var i,o,s,a,u,l;for(null==n&&(n=e),u=[],o=0,s=(a=function(){l=[];for(var n=0,e=r(t.length/2);0<=e?n<e:n>e;0<=e?n++:n--)l.push(n);return l}.apply(this).reverse()).length;o<s;o++)i=a[o],u.push(y(t,i,n));return u},p=function(t,n,r){var i;if(null==r&&(r=e),-1!==(i=t.indexOf(n)))return d(t,0,i,r),y(t,i,r)},h=function(t,n,r){var o,s,u,l,c;if(null==r&&(r=e),!(s=t.slice(0,n)).length)return s;for(i(s,r),u=0,l=(c=t.slice(n)).length;u<l;u++)o=c[u],a(s,o,r);return s.sort(r).reverse()},f=function(t,n,r){var s,a,u,h,f,p,d,y,v;if(null==r&&(r=e),10*n<=t.length){if(!(u=t.slice(0,n).sort(r)).length)return u;for(a=u[u.length-1],h=0,p=(d=t.slice(n)).length;h<p;h++)r(s=d[h],a)<0&&(l(u,s,0,null,r),u.pop(),a=u[u.length-1]);return u}for(i(t,r),v=[],f=0,y=c(n,t.length);0<=y?f<y:f>y;0<=y?++f:--f)v.push(o(t,r));return v},d=function(t,n,r,i){var o,s,a;for(null==i&&(i=e),o=t[r];r>n&&i(o,s=t[a=r-1>>1])<0;)t[r]=s,r=a;return t[r]=o},y=function(t,n,r){var i,o,s,a,u;for(null==r&&(r=e),o=t.length,u=n,s=t[n],i=2*n+1;i<o;)(a=i+1)<o&&!(r(t[i],t[a])<0)&&(i=a),t[n]=t[i],i=2*(n=i)+1;return t[n]=s,d(t,u,n,r)},n=function(){function t(t){this.cmp=null!=t?t:e,this.nodes=[]}return t.push=s,t.pop=o,t.replace=u,t.pushpop=a,t.heapify=i,t.updateItem=p,t.nlargest=h,t.nsmallest=f,t.prototype.push=function(t){return s(this.nodes,t,this.cmp)},t.prototype.pop=function(){return o(this.nodes,this.cmp)},t.prototype.peek=function(){return this.nodes[0]},t.prototype.contains=function(t){return-1!==this.nodes.indexOf(t)},t.prototype.replace=function(t){return u(this.nodes,t,this.cmp)},t.prototype.pushpop=function(t){return a(this.nodes,t,this.cmp)},t.prototype.heapify=function(){return i(this.nodes,this.cmp)},t.prototype.updateItem=function(t){return p(this.nodes,t,this.cmp)},t.prototype.clear=function(){return this.nodes=[]},t.prototype.empty=function(){return 0===this.nodes.length},t.prototype.size=function(){return this.nodes.length},t.prototype.clone=function(){var n;return n=new t,n.nodes=this.nodes.slice(0),n},t.prototype.toArray=function(){return this.nodes.slice(0)},t.prototype.insert=t.prototype.push,t.prototype.top=t.prototype.peek,t.prototype.front=t.prototype.peek,t.prototype.has=t.prototype.contains,t.prototype.copy=t.prototype.clone,t}(),function(n,e){t.exports=e()}(0,function(){return n})}).call(this)}),i={};var o=i,s=1;return i.js=function(){var t,o,a,u=!1,l={},c={},h={},f={},p=!0,d={},y=[],v=Number.MAX_VALUE,g=!1;this.setAcceptableTiles=function(t){t instanceof Array?a=t:!isNaN(parseFloat(t))&&isFinite(t)&&(a=[t])},this.enableSync=function(){u=!0},this.disableSync=function(){u=!1},this.enableDiagonals=function(){g=!0},this.disableDiagonals=function(){g=!1},this.setGrid=function(n){t=n;for(var e=0;e<t.length;e++)for(var r=0;r<t[0].length;r++)c[t[e][r]]||(c[t[e][r]]=1)},this.setTileCost=function(t,n){c[t]=n},this.setAdditionalPointCost=function(t,n,e){void 0===h[n]&&(h[n]={}),h[n][t]=e},this.removeAdditionalPointCost=function(t,n){void 0!==h[n]&&delete h[n][t]},this.removeAllAdditionalPointCosts=function(){h={}},this.setDirectionalCondition=function(t,n,e){void 0===f[n]&&(f[n]={}),f[n][t]=e},this.removeAllDirectionalConditions=function(){f={}},this.setIterationsPerCalculation=function(t){v=t},this.avoidAdditionalPoint=function(t,n){void 0===l[n]&&(l[n]={}),l[n][t]=1},this.stopAvoidingAdditionalPoint=function(t,n){void 0!==l[n]&&delete l[n][t]},this.enableCornerCutting=function(){p=!0},this.disableCornerCutting=function(){p=!1},this.stopAvoidingAllAdditionalPoints=function(){l={}},this.findPath=function(e,i,o,l,c){var h=function(t){u?c(t):setTimeout(function(){c(t)})};if(void 0===a)throw new Error("You can't set a path without first calling setAcceptableTiles() on EasyStar.");if(void 0===t)throw new Error("You can't set a path without first calling setGrid() on EasyStar.");if(e<0||i<0||o<0||l<0||e>t[0].length-1||i>t.length-1||o>t[0].length-1||l>t.length-1)throw new Error("Your start or end point is outside the scope of your grid.");if(e!==o||i!==l){for(var f=t[l][o],p=!1,v=0;v<a.length;v++)if(f===a[v]){p=!0;break}if(!1!==p){var g=new n;g.openList=new r(function(t,n){return t.bestGuessDistance()-n.bestGuessDistance()}),g.isDoneCalculating=!1,g.nodeHash={},g.startX=e,g.startY=i,g.endX=o,g.endY=l,g.callback=h,g.openList.push(P(g,g.startX,g.startY,null,1));var T=s++;return d[T]=g,y.push(T),T}h(null)}else h([])},this.cancelPath=function(t){return t in d&&(delete d[t],!0)},this.calculate=function(){if(0!==y.length&&void 0!==t&&void 0!==a)for(o=0;o<v;o++){if(0===y.length)return;u&&(o=0);var n=y[0],e=d[n];if(void 0!==e)if(0!==e.openList.size()){var r=e.openList.pop();if(e.endX!==r.x||e.endY!==r.y)r.list=0,r.y>0&&T(e,r,0,-1,1*b(r.x,r.y-1)),r.x<t[0].length-1&&T(e,r,1,0,1*b(r.x+1,r.y)),r.y<t.length-1&&T(e,r,0,1,1*b(r.x,r.y+1)),r.x>0&&T(e,r,-1,0,1*b(r.x-1,r.y)),g&&(r.x>0&&r.y>0&&(p||x(t,a,r.x,r.y-1)&&x(t,a,r.x-1,r.y))&&T(e,r,-1,-1,1.4*b(r.x-1,r.y-1)),r.x<t[0].length-1&&r.y<t.length-1&&(p||x(t,a,r.x,r.y+1)&&x(t,a,r.x+1,r.y))&&T(e,r,1,1,1.4*b(r.x+1,r.y+1)),r.x<t[0].length-1&&r.y>0&&(p||x(t,a,r.x,r.y-1)&&x(t,a,r.x+1,r.y))&&T(e,r,1,-1,1.4*b(r.x+1,r.y-1)),r.x>0&&r.y<t.length-1&&(p||x(t,a,r.x,r.y+1)&&x(t,a,r.x-1,r.y))&&T(e,r,-1,1,1.4*b(r.x-1,r.y+1)));else{var i=[];i.push({x:r.x,y:r.y});for(var s=r.parent;null!=s;)i.push({x:s.x,y:s.y}),s=s.parent;i.reverse();var l=i;e.callback(l),delete d[n],y.shift()}}else e.callback(null),delete d[n],y.shift();else y.shift()}};var T=function(n,e,r,i,o){var s=e.x+r,u=e.y+i;if((void 0===l[u]||void 0===l[u][s])&&x(t,a,s,u,e)){var c=P(n,s,u,e,o);void 0===c.list?(c.list=1,n.openList.push(c)):e.costSoFar+o<c.costSoFar&&(c.costSoFar=e.costSoFar+o,c.parent=e,n.openList.updateItem(c))}},x=function(t,n,e,r,i){var o=f[r]&&f[r][e];if(o){var s=O(i.x-e,i.y-r);if(!function(){for(var t=0;t<o.length;t++)if(o[t]===s)return!0;return!1}())return!1}for(var a=0;a<n.length;a++)if(t[r][e]===n[a])return!0;return!1},O=function(t,n){if(0===t&&-1===n)return i.TOP;if(1===t&&-1===n)return i.TOP_RIGHT;if(1===t&&0===n)return i.RIGHT;if(1===t&&1===n)return i.BOTTOM_RIGHT;if(0===t&&1===n)return i.BOTTOM;if(-1===t&&1===n)return i.BOTTOM_LEFT;if(-1===t&&0===n)return i.LEFT;if(-1===t&&-1===n)return i.TOP_LEFT;throw new Error("These differences are not valid: "+t+", "+n)},b=function(n,e){return h[e]&&h[e][n]||c[t[e][n]]},P=function(t,n,r,i,o){if(void 0!==t.nodeHash[r]){if(void 0!==t.nodeHash[r][n])return t.nodeHash[r][n]}else t.nodeHash[r]={};var s=_(n,r,t.endX,t.endY);if(null!==i)var a=i.costSoFar+o;else a=0;var u=new e(i,n,r,a,s);return t.nodeHash[r][n]=u,u},_=function(t,n,e,r){if(g)return(i=Math.abs(t-e))<(o=Math.abs(n-r))?1.4*i+o:1.4*o+i;var i=Math.abs(t-e),o=Math.abs(n-r);return i+o}},i.TOP="TOP",i.TOP_RIGHT="TOP_RIGHT",i.RIGHT="RIGHT",i.BOTTOM_RIGHT="BOTTOM_RIGHT",i.BOTTOM="BOTTOM",i.BOTTOM_LEFT="BOTTOM_LEFT",i.LEFT="LEFT",i.TOP_LEFT="TOP_LEFT",function(t){return t&&t.__esModule?t.default:t}(t(function(t,n){var e=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var r=function(t){function n(n){var e=t.call(this,n,n.plugins)||this;return e.easystar=new o.js,e.callback=null,e.prepared=!1,e}return e(n,t),n.prototype.setGrid=function(t,n,e){void 0===e&&(e=Number.MAX_VALUE),this.grid=[];for(var r=0;r<t.length;r++){this.grid[r]=[];for(var i=0;i<t[r].length;i++)this.grid[r][i]=t[r][i]?t[r][i].index:0}this.easystar.setGrid(this.grid),this.easystar.setAcceptableTiles(n);for(var o=0,s=n;o<s.length;o++){var a=s[o];this.easystar.setTileCost(a,1)}this.easystar.setIterationsPerCalculation(e)},n.prototype.setCallbackFunction=function(t){this.callback=t},n.prototype.preparePathCalculation=function(t,n){if(null===this.callback)throw new Error("no callback set");this.easystar.findPath(t[0],t[1],n[0],n[1],this.callback),this.prepared=!0},n.prototype.calculatePath=function(){if(!this.prepared)throw new Error("no calculation prepared!");this.easystar.calculate()},n}(Phaser.Plugin);n.default=r}))}();
